---
// ConnectedSections.astro
// Advanced component untuk transisi fade mulus antara 2 section
// Semua props memberikan efek yang berguna dan reusable

import Image from 'astro/components/Image.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  // Background images (required & actually used)
  topImage: ImageMetadata;
  bottomImage: ImageMetadata;

  // Fade configuration
  fadeHeight?: string;
  fadeColor?: string;
  fadeOpacity?: string;

  // Section heights
  topHeight?: string;
  bottomHeight?: string;

  // Simple overlay (optional utility)
  topOverlayColor?: string;
  topOverlayOpacity?: string;
  bottomOverlayColor?: string;
  bottomOverlayOpacity?: string;

  // Connector styling (useful utility)
  connectorColor?: string;
  connectorHeight?: string;

  // Enable/disable features
  enableFade?: boolean;
  enableOverlay?: boolean;
  enableConnector?: boolean;
}

const {
  topImage,
  bottomImage,
  fadeHeight = "h-96",
  fadeColor = "primary",
  fadeOpacity = "75",
  topHeight = "min-h-screen",
  bottomHeight = "min-h-screen",
  topOverlayColor = "primary",
  topOverlayOpacity = "0.1",
  bottomOverlayColor = "accent-dark",
  bottomOverlayOpacity = "0.5",
  connectorColor = "primary",
  connectorHeight = "h-8 lg:h-16",
  enableFade = true,
  enableOverlay = false,
  enableConnector = true,
} = Astro.props;

// No data attributes needed - images are handled by Astro's Image component
---

<div class="connected-sections-wrapper relative">
  <!-- Top Section -->
  <div
    class={`relative ${topHeight} overflow-hidden`}
    data-connected-section="top"
  >
    <!-- Top Background Image -->
    {topImage && (
      <Image
        src={topImage}
        alt="Top section background"
        class="absolute inset-0 w-full h-full object-cover z-5"
        loading="eager"
        width={1920}
        height={1080}
        format="webp"
      />
    )}

    <!-- Overlay (conditional) -->
    {enableOverlay && (
      <div
        class="absolute inset-0 z-10"
        style={`background-color: rgb(var(--color-${topOverlayColor}) / ${topOverlayOpacity});`}
      ></div>
    )}

    <!-- Fade ke bawah: transparan → fadeColor → fadeColor solid (conditional) -->
    {enableFade && (
      <div
        class:list={[
          "absolute bottom-0 left-0 w-full pointer-events-none z-15",
          fadeHeight,
        ]}
        style={`
          background: linear-gradient(to bottom,
            transparent,
            rgb(var(--color-${fadeColor}) / ${fadeOpacity}%),
            rgb(var(--color-${fadeColor}))
          );
        `}
      ></div>
    )}

    <!-- Top Content -->
    <div class="relative z-20">
      <slot name="top-section" />
    </div>
  </div>

  <!-- Connector (conditional) -->
  {enableConnector && (
    <div
      class={connectorHeight}
      style={`background-color: rgb(var(--color-${connectorColor}));`}
    ></div>
  )}

  <!-- Bottom Section -->
  <div
    class={`relative ${bottomHeight} align-middle overflow-hidden`}
    data-connected-section="bottom"
  >
    <!-- Bottom Background Image -->
    {bottomImage && (
      <Image
        src={bottomImage}
        alt="Bottom section background"
        class="absolute inset-0 w-full h-full object-cover z-5"
        loading="lazy"
        width={1920}
        height={1080}
        format="webp"
      />
    )}

    <!-- Overlay (conditional) -->
    {enableOverlay && (
      <div
        class="absolute inset-0 z-10"
        style={`background-color: rgb(var(--color-${bottomOverlayColor}) / ${bottomOverlayOpacity});`}
      ></div>
    )}

    <!-- Fade ke atas: fadeColor solid → fadeColor → transparan (conditional) -->
    {enableFade && (
      <div
        class:list={[
          "absolute top-0 left-0 w-full pointer-events-none z-15",
          fadeHeight,
        ]}
        style={`
          background: linear-gradient(to bottom,
            rgb(var(--color-${fadeColor})),
            rgb(var(--color-${fadeColor}) / ${fadeOpacity}%),
            transparent
          );
        `}
      ></div>
    )}

    <!-- Bottom Content -->
    <div class="relative z-20">
      <slot name="bottom-section" />
    </div>
  </div>
</div>

<!-- No JavaScript needed - images are handled by Astro's Image component -->

<style>
  /* Prevent any margin/padding issues */
  .connected-sections-wrapper > section {
    margin: 0;
    padding: 0;
  }

  /* Ensure fade layers don't interfere with content */
  .connected-sections-wrapper [class*="bg-gradient"] {
    mix-blend-mode: normal;
  }
</style>
